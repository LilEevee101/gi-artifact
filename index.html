<!DOCTYPE html>
<html>
    <head>
        <title>Genshin Artifact Guide</title>
        <script src="https://code.jquery.com/jquery-3.5.1.js" 
        integrity="sha256-QWo7LDvxbWT2tbbQ97B53yJnYU3WhH/C8ycbRAkjPDc=" 
        crossorigin="anonymous">
        </script>
        <script src="/node_modules/angular/angular.js"></script>
        <script src="/node_modules/angular-route/angular-route.js"></script>
        <link href="style.css" rel="stylesheet">
    </head>
    <body ng-app="app">
        <div ng-view></div>

        <script>
           var app = angular.module("app", ['ngRoute']);
           app.config(['$routeProvider',  function($routeProvider) {
               $routeProvider
               .when("/start",{
                   templateUrl: "templates/step1.html",
                   controller: "characterController"
               })
               .when("/details",{
                   templateUrl: "templates/step2.html",
                   controller: "detailController"
               })
               .when("/results",{
                   templateUrl: "templates/step3.html",
                   controller: "resultController"
               })
               .otherwise({
                   redirectTo: '/start'
               })
           }]);
           
           app.controller("characterController", function($scope,$http,$rootScope) {
                $scope.pagetitle = 'success';             
               
               $scope.setcharacter = function(character){
                   $rootScope.player = character
               }

                $http.get("http://localhost:3000/api/characters")
                .then(function(response){
                   $scope.charlist = response.data;
                });
            });
            app.controller("detailController", function($scope,$http,$rootScope,$location) {
                $scope.pagetitle = 'details';
                    $scope.player = $rootScope.player;
                    if (!$scope.player) {
                        $location.path('/start');  
                    }
                    $http.get("http://localhost:3000/api/builds")
                    .then(function(response){
                    $scope.buildtypes = response.data;
                    });
                    $http.get("http://localhost:3000/api/elements")
                    .then(function(response){
                    $scope.elementlist = response.data;
                    });
                    $http.get("http://localhost:3000/api/weapons")
                    .then(function(response){
                    $scope.weapons = response.data;
                    });
            });
            app.controller("resultController", function($scope,$http,$rootScope) {
                $scope.player = $rootScope.player;
                $scope.pagetitle = 'results';
                $http.get("http://localhost:3000/api/artifacts")
                    .then(function(response){
                        $scope.artifactlist = response.data;
                        $scope.choice = $scope.artifactlist.filter (function (arti){
                            var tags = arti.tags;
                            var success = tags.filter (function (t){
                                return t == $scope.player.build;
                            });
                            if (success.length > 0){
                                return arti;
                            };
                        });
                        console.log ($scope.choice);
                    });
            });
        </script>


    </body>
</html>